// Fill out your copyright notice in the Description page of Project Settings.

#pragma once

#include "CoreMinimal.h"
#include "GameFramework/Character.h"
#include "MyCharacter.generated.h"

// å‰ç½®å£°æ˜
class USpringArmComponent;
class UCameraComponent;
class USphereComponent;
class UInputComponent;
class UUserWidget;
class UWidgetComponent;
class UCanvasPanelSlot;  // ç”¨äºSocketæŠ•å°„ç³»ç»Ÿ

UCLASS()
class SOUL_API AMyCharacter : public ACharacter
{
	GENERATED_BODY()

public:
	// Sets default values for this character's properties
	AMyCharacter();

protected:
	// Called when the game starts or when spawned
	virtual void BeginPlay() override;

	// ==================== å¸¸é‡å®šä¹‰ ====================
	// ç›®æ ‡æŸ¥æ‰¾é¢‘ç‡ï¼ˆç§’ï¼‰
	static constexpr float TARGET_SEARCH_INTERVAL = 0.2f;
	
	// è§’è‰²æ—‹è½¬é€Ÿåº¦
	static constexpr float CHARACTER_ROTATION_SPEED = 10.0f;
	
	// å°„çº¿æ£€æµ‹é«˜åº¦åç§»
	static constexpr float RAYCAST_HEIGHT_OFFSET = 50.0f;
	
	// æ‘‡æ†åˆ‡æ¢ç›®æ ‡çš„é˜ˆå€¼
	static constexpr float THUMBSTICK_THRESHOLD = 0.5f; // é™ä½é˜ˆå€¼ï¼Œæ›´å®¹æ˜“è§¦å‘

	// é”å®šåˆ‡æ¢è§’åº¦é˜ˆå€¼ï¼ˆåº¦ï¼‰- å°äºæ­¤è§’åº¦æ—¶ä¸æ—‹è½¬ç›¸æœºå’Œè§’è‰²
	static constexpr float TARGET_SWITCH_ANGLE_THRESHOLD = 20.0f;
	
	// é”å®šåˆ‡æ¢æ—¶çš„å¹³æ»‘æ’å€¼é€Ÿåº¦
	static constexpr float TARGET_SWITCH_SMOOTH_SPEED = 3.0f;

	// æ–°å¢å¸¸é‡ï¼šå‡å°‘é­”æ³•æ•°å­—
	static constexpr float UI_HEIGHT_OFFSET = 80.0f;
	static constexpr float LOCK_COMPLETION_THRESHOLD = 5.0f;
	static constexpr float SMOOTH_SWITCH_ANGLE_THRESHOLD = 2.0f;
	static constexpr float EXTENDED_LOCK_RANGE_MULTIPLIER = 1.5f;

	// ==================== æ‰‡å½¢é”å®šåŒºåŸŸå¸¸é‡ ====================
	// æ‰‡å½¢é”å®šåŒºåŸŸï¼šå‰æ–¹2/3åŒºåŸŸçš„è§’åº¦èŒƒå›´ï¼ˆæ›´å‡†ç¡®çš„å‰æ–¹åŒºåŸŸï¼‰
	static constexpr float SECTOR_LOCK_ANGLE = 100.0f; // æ‰‡å½¢é”å®šèŒƒå›´ï¼ˆÂ±50åº¦ï¼‰
	
	// è¾¹ç¼˜é”å®šæ£€æµ‹è§’åº¦ï¼šç”¨äºæ£€æµ‹å±å¹•è¾¹ç¼˜çš„ç›®æ ‡
	static constexpr float EDGE_DETECTION_ANGLE = 120.0f; // è¾¹ç¼˜æ£€æµ‹èŒƒå›´ï¼ˆÂ±120åº¦ï¼‰
	
	// ç›¸æœºè‡ªåŠ¨ä¿®æ­£é€Ÿåº¦ï¼ˆå½“é”å®šè¾¹ç¼˜ç›®æ ‡æ—¶ï¼‰
	static constexpr float CAMERA_AUTO_CORRECTION_SPEED = 7.0f;
	
	// è¾¹ç¼˜é”å®šæ—¶ç›¸æœºä¿®æ­£çš„ç›®æ ‡è§’åº¦åç§»ï¼ˆå‡å°‘ä¿®æ­£å¹…åº¦ï¼‰
	static constexpr float CAMERA_CORRECTION_OFFSET = 150.0f; // ä¿®æ­£150åº¦è®©ç›®æ ‡è¿›å…¥ä¸»é”å®šåŒºåŸŸ

	// ==================== ç›¸æœºé‡ç½®å¸¸é‡ ====================
	// ç›¸æœºé‡ç½®å¹³æ»‘æ’å€¼é€Ÿåº¦
	static constexpr float CAMERA_RESET_SPEED = 7.0f; // æ§åˆ¶ç›¸æœºé‡ç½®çš„å¹³æ»‘é€Ÿåº¦
	
	// ç›¸æœºé‡ç½®è§’åº¦é˜ˆå€¼ï¼ˆå°äºæ­¤è§’åº¦æ—¶åœæ­¢æ’å€¼ï¼‰
	static constexpr float CAMERA_RESET_ANGLE_THRESHOLD = 1.0f;

	// ==================== ç›¸æœºç»„ä»¶ ====================
	UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = Camera, meta = (AllowPrivateAccess = "true"))
	USpringArmComponent* CameraBoom;

	UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = Camera, meta = (AllowPrivateAccess = "true"))
	UCameraComponent* FollowCamera;

	// ==================== é”å®šç›¸æœºæ§åˆ¶å‚æ•° ====================
	// å¯è°ƒèŠ‚çš„ç›¸æœºæ’å€¼é€Ÿåº¦ï¼ˆä¸è“å›¾ä¸€è‡´çš„å‚æ•°ï¼‰
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn Camera", meta = (ClampMin = "1.0", ClampMax = "20.0"))
	float CameraInterpSpeed = 5.0f;
	
	// æ˜¯å¦å¯ç”¨å¹³æ»‘ç›¸æœºè·Ÿè¸ª
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn Camera")
	bool bEnableSmoothCameraTracking = true;
	
	// ç›¸æœºè·Ÿè¸ªæ¨¡å¼ï¼š0=å®Œå…¨è·Ÿè¸ªï¼Œ1=ä»…æ°´å¹³è·Ÿè¸ªï¼Œ2=è‡ªå®šä¹‰
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn Camera", meta = (ClampMin = "0", ClampMax = "2"))
	int32 CameraTrackingMode = 0;

	// æ–°å¢ï¼šç›®æ ‡ä½ç½®åç§»ï¼ˆå¯¹åº”è“å›¾ä¸­çš„Vectorå‡æ³•ï¼‰
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn Camera")
	FVector TargetLocationOffset = FVector(0.0f, 0.0f, -450.0f);

	// ==================== é”å®šä¸ç´¢æ•Œç›¸å…³ ====================
	// é”å®šçŠ¶æ€
	UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "LockOn")
	bool bIsLockedOn;

	// å½“å‰é”å®šçš„ç›®æ ‡
	UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "LockOn")
	AActor* CurrentLockOnTarget;

	// å¯é”å®šç›®æ ‡åˆ—è¡¨
	UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "LockOn")
	TArray<AActor*> LockOnCandidates;

	// ç´¢æ•Œæ£€æµ‹çƒä½“ï¼ˆç”¨äºæ£€æµ‹é™„è¿‘æ•Œäººï¼‰
	UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "LockOn")
	USphereComponent* LockOnDetectionSphere;

	// é”å®šèŒƒå›´
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn", meta = (ClampMin = "100.0", ClampMax = "3000.0"))
	float LockOnRange;

	// é”å®šè§’åº¦ï¼ˆè§†é‡èŒƒå›´ï¼‰
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn", meta = (ClampMin = "30.0", ClampMax = "180.0"))
	float LockOnAngle;

	// ç›®æ ‡åˆ‡æ¢çŠ¶æ€
	bool bJustSwitchedTarget = false;
	float TargetSwitchCooldown = 0.5f;
	float LastTargetSwitchTime = 0.0f;

	// æ–°å¢ï¼šé”å®šåˆ‡æ¢ç›¸å…³çŠ¶æ€
	bool bIsSmoothSwitching = false;			// æ˜¯å¦æ­£åœ¨è¿›è¡Œå¹³æ»‘åˆ‡æ¢
	float SmoothSwitchStartTime = 0.0f;		// å¹³æ»‘åˆ‡æ¢å¼€å§‹æ—¶é—´
	FRotator SmoothSwitchStartRotation = FRotator::ZeroRotator;	// å¹³æ»‘åˆ‡æ¢èµ·å§‹æ—‹è½¬
	FRotator SmoothSwitchTargetRotation = FRotator::ZeroRotator;// å¹³æ»‘åˆ‡æ¢ç›®æ ‡æ—‹è½¬
	bool bShouldSmoothSwitchCamera = false;		// ç›¸æœºæ˜¯å¦éœ€è¦å¹³æ»‘åˆ‡æ¢
	bool bShouldSmoothSwitchCharacter = false;	// è§’è‰²æ˜¯å¦éœ€è¦å¹³æ»‘åˆ‡æ¢

	// æ–°å¢ï¼šç›¸æœºè·Ÿéšæ§åˆ¶
	bool bShouldCameraFollowTarget = true;		// ç›¸æœºæ˜¯å¦åº”è¯¥è·Ÿéšç›®æ ‡
	bool bShouldCharacterRotateToTarget = true; // è§’è‰²èº«ä½“æ˜¯å¦åº”è¯¥è½¬å‘ç›®æ ‡
	bool bPlayerIsMoving = false;				// ç©å®¶æ˜¯å¦åœ¨ç§»åŠ¨

	// ==================== æ‰‡å½¢é”å®šç›¸å…³çŠ¶æ€ ====================
	// ç›¸æœºè‡ªåŠ¨ä¿®æ­£çŠ¶æ€
	bool bIsCameraAutoCorrection = false;		// æ˜¯å¦æ­£åœ¨è¿›è¡Œç›¸æœºè‡ªåŠ¨ä¿®æ­£
	float CameraCorrectionStartTime = 0.0f;	// ä¿®æ­£å¼€å§‹æ—¶é—´
	FRotator CameraCorrectionStartRotation = FRotator::ZeroRotator; // ä¿®æ­£èµ·å§‹ç›¸æœºæ—‹è½¬
	FRotator CameraCorrectionTargetRotation = FRotator::ZeroRotator; // ä¿®æ­£ç›®æ ‡ç›¸æœºæ—‹è½¬

	// å»¶è¿Ÿä¿®æ­£çš„ç›®æ ‡å¼•ç”¨
	UPROPERTY()
	AActor* DelayedCorrectionTarget = nullptr;

	// ==================== ç›¸æœºé‡ç½®ç›¸å…³çŠ¶æ€ ====================
	// æ˜¯å¦æ­£åœ¨è¿›è¡Œå¹³æ»‘ç›¸æœºé‡ç½®
	bool bIsSmoothCameraReset = false;
	
	// å¹³æ»‘é‡ç½®å¼€å§‹æ—¶é—´
	float SmoothResetStartTime = 0.0f;
	
	// å¹³æ»‘é‡ç½®èµ·å§‹ç›¸æœºæ—‹è½¬
	FRotator SmoothResetStartRotation = FRotator::ZeroRotator;
	
	// å¹³æ»‘é‡ç½®ç›®æ ‡ç›¸æœºæ—‹è½¬
	FRotator SmoothResetTargetRotation = FRotator::ZeroRotator;

	// ==================== è°ƒè¯•æ§åˆ¶ ====================
	// æ˜¯å¦å¯ç”¨ç›¸æœºè°ƒè¯•æ—¥å¿—
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Debug")
	bool bEnableCameraDebugLogs = false;
	
	// æ˜¯å¦å¯ç”¨é”å®šè°ƒè¯•æ—¥å¿—
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Debug")
	bool bEnableLockOnDebugLogs = false;

	// ==================== UMGç›¸å…³å£°æ˜ ====================
	// é”å®šUI Widgetç±»å¼•ç”¨ï¼ˆåœ¨è“å›¾ä¸­è®¾ç½®ï¼‰
	UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "UI")
	TSubclassOf<UUserWidget> LockOnWidgetClass;

	// å½“å‰æ˜¾ç¤ºçš„é”å®šUI Widgetå®ä¾‹
	UPROPERTY()
	UUserWidget* LockOnWidgetInstance;

	// æ–°å¢ï¼šè¿½è¸ªä¸Šä¸€ä¸ªé”å®šç›®æ ‡ï¼Œç”¨äºUIç®¡ç†
	UPROPERTY()
	AActor* PreviousLockOnTarget = nullptr;

	// ==================== SocketæŠ•å°„ç³»ç»Ÿå£°æ˜ ====================  // ğŸ‘ˆ åœ¨è¿™é‡Œæ·»åŠ æ–°çš„å£°æ˜
	// SocketæŠ•å°„ç›¸å…³
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn Socket")
	FName TargetSocketName = TEXT("Spine2Socket");

	// æŠ•å°„ç›¸å…³å‚æ•°
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn Socket", meta = (ClampMin = "0.1", ClampMax = "10.0"))
	float ProjectionScale = 1.0f;

	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn Socket")
	FVector SocketOffset = FVector(0.0f, 0.0f, 50.0f);

	// æ˜¯å¦å¯ç”¨SocketæŠ•å°„ï¼ˆç”¨äºé€æ­¥è¿ç§»ï¼‰
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "LockOn Socket")
	bool bUseSocketProjection = true;

	// SocketæŠ•å°„ç›¸å…³å‡½æ•°å£°æ˜
	UFUNCTION(BlueprintCallable, Category = "LockOn Socket")
	FVector GetTargetSocketWorldLocation(AActor* Target) const;

	UFUNCTION(BlueprintCallable, Category = "LockOn Socket")
	bool HasValidSocket(AActor* Target) const;

	UFUNCTION(BlueprintCallable, Category = "LockOn Socket")
	FVector2D ProjectSocketToScreen(const FVector& SocketWorldLocation) const;

	// SocketæŠ•å°„UMGç›¸å…³å‡½æ•°å£°æ˜
	UFUNCTION(BlueprintCallable, Category = "LockOn Socket")
	void ShowSocketProjectionWidget();
	
	UFUNCTION(BlueprintCallable, Category = "LockOn Socket")
	void UpdateSocketProjectionWidget();
	
	UFUNCTION(BlueprintCallable, Category = "LockOn Socket")
	void HideSocketProjectionWidget();


	// ==================== ç§»åŠ¨å‚æ•° ====================
	// æ™®é€šç§»åŠ¨é€Ÿåº¦
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Movement", meta = (ClampMin = "100.0", ClampMax = "1000.0"))
	float NormalWalkSpeed;

	// é”å®šçŠ¶æ€ä¸‹çš„ç§»åŠ¨é€Ÿåº¦
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Movement", meta = (ClampMin = "50.0", ClampMax = "500.0"))
	float LockedWalkSpeed;

	// å½“å‰ç§»åŠ¨è¾“å…¥å€¼ï¼ˆç”¨äºåŠ¨ç”»ï¼‰
	UPROPERTY(BlueprintReadOnly, Category = "Movement")
	float ForwardInputValue;

	UPROPERTY(BlueprintReadOnly, Category = "Movement")
	float RightInputValue;

	// ==================== è¾“å…¥çŠ¶æ€è·Ÿè¸ª ====================
	// å³æ‘‡æ†è¾“å…¥çŠ¶æ€è·Ÿè¸ª
	bool bRightStickLeftPressed = false;
	bool bRightStickRightPressed = false;
	float LastRightStickX = 0.0f;

	// ==================== æ€§èƒ½ä¼˜åŒ– ====================
	// ä¸Šæ¬¡æŸ¥æ‰¾ç›®æ ‡çš„æ—¶é—´
	float LastFindTargetsTime = 0.0f;

	// ==================== ç§»åŠ¨å‡½æ•° ====================
	void MoveForward(float Value);
	void MoveRight(float Value);
	void StartJump();
	void StopJump();

	// ç›¸æœºæ§åˆ¶
	void Turn(float Rate);
	void LookUp(float Rate);

	// ==================== æ–°çš„è¾“å…¥å¤„ç†å‡½æ•° ====================
	// å³æ‘‡æ†æ°´å¹³è¾“å…¥å¤„ç†ï¼ˆç”¨äºåˆ‡æ¢ç›®æ ‡ï¼‰
	void HandleRightStickX(float Value);
	
	// é”å®šæŒ‰é’®å¤„ç†
	void HandleLockOnButton();

	// è°ƒè¯•å‡½æ•°
	void DebugInputTest();

	// æ–°å¢ï¼šéªŒè¯UMG Widgetè®¾ç½®çš„è°ƒè¯•å‡½æ•°
	UFUNCTION(BlueprintCallable, Category = "Debug")
	void DebugWidgetSetup();

	// ==================== UMGç›¸å…³å‡½æ•°å£°æ˜ ====================
	// æ˜¾ç¤ºé”å®šUI
	UFUNCTION(BlueprintCallable, Category = "UI")
	void ShowLockOnWidget();

	// éšè—é”å®šUI
	UFUNCTION(BlueprintCallable, Category = "UI")
	void HideLockOnWidget();

	// éšè—æ‰€æœ‰ç›®æ ‡çš„é”å®šUI
	UFUNCTION(BlueprintCallable, Category = "UI")
	void HideAllLockOnWidgets();

	// æ›´æ–°é”å®šUIä½ç½®å’ŒçŠ¶æ€
	UFUNCTION(BlueprintCallable, Category = "UI")
	void UpdateLockOnWidget();

	// ==================== é”å®šç³»ç»Ÿæ–¹æ³• ====================
	// åˆ‡æ¢é”å®š
	void ToggleLockOn();

	// æŸ¥æ‰¾å¯é”å®šç›®æ ‡
	void FindLockOnCandidates();

	// æ–°å¢ï¼šæ£€æŸ¥çƒä½“å†…æ˜¯å¦æœ‰å€™é€‰ç›®æ ‡
	bool HasCandidatesInSphere();
	
	// æ–°å¢ï¼šæ‰§è¡Œç®€å•çš„ç›¸æœºé‡ç½®
	void PerformSimpleCameraReset();
	
	// æ–°å¢ï¼šå¼€å§‹é”å®šç›®æ ‡
	void StartLockOn(AActor* Target);
	
	// æ–°å¢ï¼šå–æ¶ˆé”å®š
	void CancelLockOn();
	
	// æ–°å¢ï¼šç›¸æœºé‡ç½®åˆ°æŒ‡å®šæ—‹è½¬
	void StartCameraReset(const FRotator& TargetRotation);

	// æ–°å¢ï¼šå¼€å§‹å¹³æ»‘ç›¸æœºé‡ç½®
	void StartSmoothCameraReset();
	
	// æ–°å¢ï¼šæ›´æ–°å¹³æ»‘ç›¸æœºé‡ç½®
	void UpdateSmoothCameraReset();

	// åˆ‡æ¢é”å®šç›®æ ‡ï¼ˆå·¦å³åˆ‡æ¢ï¼‰
	void SwitchLockOnTargetLeft();
	void SwitchLockOnTargetRight();
	
	// åˆ‡æ¢ç›®æ ‡æ—¶æ›´æ–°è§’è‰²æœå‘ï¼ˆä½†ä¸æ›´æ–°ç›¸æœºï¼‰
	void UpdateCharacterRotationToTarget();

	// æ–°å¢ï¼šè®¡ç®—åˆ°ç›®æ ‡çš„è§’åº¦å·®å¼‚
	float CalculateAngleToTarget(AActor* Target) const;
	
	// æ–°å¢ï¼šè®¡ç®—ç›®æ ‡ç›¸å¯¹äºç©å®¶çš„æ–¹å‘è§’åº¦ï¼ˆ-180åˆ°180åº¦ï¼Œå·¦è´Ÿå³æ­£ï¼‰
	float CalculateDirectionAngle(AActor* Target) const;
	
	// æ–°å¢ï¼šæŒ‰æ–¹å‘è§’åº¦æ’åºå€™é€‰ç›®æ ‡ï¼ˆä»å·¦åˆ°å³ï¼‰
	void SortCandidatesByDirection(TArray<AActor*>& Targets);

	// æ–°å¢ï¼šå¼€å§‹å¹³æ»‘åˆ‡æ¢åˆ°æ–°ç›®æ ‡
	void StartSmoothTargetSwitch(AActor* NewTarget);
	
	// æ–°å¢ï¼šæ›´æ–°å¹³æ»‘åˆ‡æ¢çŠ¶æ€
	void UpdateSmoothTargetSwitch();

	// ==================== æ‰‡å½¢é”å®šç³»ç»Ÿæ–¹æ³• ====================
	// æ£€æŸ¥ç›®æ ‡æ˜¯å¦åœ¨æ‰‡å½¢é”å®šåŒºåŸŸå†…
	bool IsTargetInSectorLockZone(AActor* Target) const;
	
	// æ£€æŸ¥ç›®æ ‡æ˜¯å¦åœ¨è¾¹ç¼˜æ£€æµ‹åŒºåŸŸå†…
	bool IsTargetInEdgeDetectionZone(AActor* Target) const;
	
	// å¼€å§‹ç›¸æœºè‡ªåŠ¨ä¿®æ­£
	void StartCameraAutoCorrection(AActor* Target);
	
	// æ›´æ–°ç›¸æœºè‡ªåŠ¨ä¿®æ­£
	void UpdateCameraAutoCorrection();
	
	// å»¶è¿Ÿç›¸æœºä¿®æ­£å‡½æ•°
	UFUNCTION()
	void DelayedCameraCorrection();
	
	// æ–°å¢ï¼šæ¢å¤ç›¸æœºè·ŸéšçŠ¶æ€å‡½æ•°
	UFUNCTION()
	void RestoreCameraFollowState();
	
	// è·å–æ‰‡å½¢åŒºåŸŸå†…çš„æœ€ä½³é”å®šç›®æ ‡
	AActor* GetBestSectorLockTarget();
	
	// ä»ç›®æ ‡åˆ—è¡¨ä¸­è·å–æœ€ä½³ç›®æ ‡ï¼ˆé€šç”¨è¯„åˆ†å‡½æ•°ï¼‰
	AActor* GetBestTargetFromList(const TArray<AActor*>& TargetList);

	// è·å–æœ€ä½³é”å®šç›®æ ‡
	AActor* GetBestLockOnTarget();

	// æ£€æŸ¥ç›®æ ‡æ˜¯å¦æœ‰æ•ˆ
	bool IsValidLockOnTarget(AActor* Target);

	// æ£€æŸ¥ç›®æ ‡æ˜¯å¦ä»ç„¶å¯ä»¥ä¿æŒé”å®šï¼ˆæ›´å®½æ¾çš„æ¡ä»¶ï¼‰
	bool IsTargetStillLockable(AActor* Target);

	// æ›´æ–°é”å®šçŠ¶æ€
	void UpdateLockOnTarget();

	// é”å®šæ—¶çš„ç›¸æœºæ›´æ–°ï¼ˆä¼˜åŒ–åçš„æ ¸å¿ƒå‡½æ•°ï¼‰
	void UpdateLockOnCamera();

	// ç»˜åˆ¶é”å®šå…‰æ ‡UIï¼ˆä»…åœ¨å¼€å‘ç‰ˆæœ¬ä¸­å¯ç”¨ï¼‰
	void DrawLockOnCursor();
	
	// é‡ç½®ç›¸æœºï¼ˆä¿æŒå…¼å®¹æ€§ï¼‰
	void ResetCamera();

	// æ–°å¢ï¼šå°è¯•è·å–æ‰‡å½¢åŒºåŸŸå†…çš„é”å®šç›®æ ‡
	AActor* TryGetSectorLockTarget();
	
	// æ–°å¢ï¼šå°è¯•è·å–éœ€è¦ç›¸æœºä¿®æ­£çš„ç›®æ ‡
	AActor* TryGetCameraCorrectionTarget();
	
	// æ–°å¢ï¼šå¼€å§‹é’ˆå¯¹ç‰¹å®šç›®æ ‡çš„ç›¸æœºä¿®æ­£
	void StartCameraCorrectionForTarget(AActor* Target);

public:
	// Called every frame
	virtual void Tick(float DeltaTime) override;

	// Called to bind functionality to input
	virtual void SetupPlayerInputComponent(class UInputComponent* PlayerInputComponent) override;

	// ==================== å…¬å…±æ¥å£ ====================
	UFUNCTION(BlueprintCallable, Category = "LockOn")
	bool IsLockedOn() const { return bIsLockedOn; }

	UFUNCTION(BlueprintCallable, Category = "LockOn")
	AActor* GetLockOnTarget() const { return CurrentLockOnTarget; }

};